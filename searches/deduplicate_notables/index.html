<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="RBA is Splunk's method to aggregate low-fidelity security events as interesting observations tagged with security metadata to create high-fidelity, low-volume alerts."><link href=../this_then_that_alerts/ rel=prev><link href=../dynamic_drilldowns/ rel=next><link rel=icon href=../../assets/rba_community_small.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.14"><title>Deduplicate Notables - Splunk RBA</title><link rel=stylesheet href=../../assets/stylesheets/main.fad675c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.356b1318.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style><script src=../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#deduplicate-notable-events class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Splunk RBA" class="md-header__button md-logo" aria-label="Splunk RBA" data-md-component=logo> <img src=../../assets/rba_community_small.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Splunk RBA </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Deduplicate Notables </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/splunk/rba title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> splunk/rba </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> Searches </a> </li> <li class=md-tabs__item> <a href=../../dashboards/ class=md-tabs__link> Dashboards </a> </li> <li class=md-tabs__item> <a href=../../contributing/contributing-guidelines/ class=md-tabs__link> Contributing </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Splunk RBA" class="md-nav__button md-logo" aria-label="Splunk RBA" data-md-component=logo> <img src=../../assets/rba_community_small.png alt=logo> </a> Splunk RBA </label> <div class=md-nav__source> <a href=https://github.com/splunk/rba title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> splunk/rba </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> Searches </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Searches </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../this_then_that_alerts/ class=md-nav__link> <span class=md-ellipsis> Chaining behaviors </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Deduplicate Notables </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Deduplicate Notables </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#navigation class=md-nav__link> <span class=md-ellipsis> Navigation </span> </a> </li> <li class=md-nav__item> <a href=#method-i class=md-nav__link> <span class=md-ellipsis> Method I </span> </a> <nav class=md-nav aria-label="Method I"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-create-a-truth-table class=md-nav__link> <span class=md-ellipsis> 1. Create a Truth Table </span> </a> </li> <li class=md-nav__item> <a href=#2-create-a-saved-search class=md-nav__link> <span class=md-ellipsis> 2. Create a Saved Search </span> </a> <nav class=md-nav aria-label="2. Create a Saved Search"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#schedule-the-saved-search class=md-nav__link> <span class=md-ellipsis> Schedule the Saved Search </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-deduplicate-notables class=md-nav__link> <span class=md-ellipsis> 3. Deduplicate notables </span> </a> </li> <li class=md-nav__item> <a href=#congratulations class=md-nav__link> <span class=md-ellipsis> Congratulations! </span> </a> </li> <li class=md-nav__item> <a href=#extra-credit class=md-nav__link> <span class=md-ellipsis> Extra Credit </span> </a> </li> <li class=md-nav__item> <a href=#create-a-calculated-field class=md-nav__link> <span class=md-ellipsis> Create a calculated field </span> </a> </li> <li class=md-nav__item> <a href=#update-spl class=md-nav__link> <span class=md-ellipsis> Update SPL </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#method-ii class=md-nav__link> <span class=md-ellipsis> Method II </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../dynamic_drilldowns/ class=md-nav__link> <span class=md-ellipsis> Dynamic Drilldowns </span> </a> </li> <li class=md-nav__item> <a href=../risk_guide_searches/ class=md-nav__link> <span class=md-ellipsis> Essential RBA searches </span> </a> </li> <li class=md-nav__item> <a href=../asset_and_identity_rir_logic/ class=md-nav__link> <span class=md-ellipsis> Integrate A&I into RiRs </span> </a> </li> <li class=md-nav__item> <a href=../limit_score_stacking/ class=md-nav__link> <span class=md-ellipsis> Limit score stacking </span> </a> </li> <li class=md-nav__item> <a href=../naming_system_unknown_computer_accounts/ class=md-nav__link> <span class=md-ellipsis> Naming SYSTEM/Unknown/Computer Accounts </span> </a> </li> <li class=md-nav__item> <a href=../risk_incident_rule_ideas/ class=md-nav__link> <span class=md-ellipsis> Risk Incident Rules </span> </a> </li> <li class=md-nav__item> <a href=../risk_info_event_detail/ class=md-nav__link> <span class=md-ellipsis> Risk info field </span> </a> </li> <li class=md-nav__item> <a href=../risk_notable_history/ class=md-nav__link> <span class=md-ellipsis> Risk Notable History </span> </a> </li> <li class=md-nav__item> <a href=../threat_object_prevalence/ class=md-nav__link> <span class=md-ellipsis> Threat Object Prevalence </span> </a> </li> <li class=md-nav__item> <a href=../threat_object_types/ class=md-nav__link> <span class=md-ellipsis> Threat Object Types </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../dashboards/ class="md-nav__link "> <span class=md-ellipsis> Dashboards </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Dashboards </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dashboards/attack_matrix_risk/ class=md-nav__link> <span class=md-ellipsis> ATT&CK Matrix Risk </span> </a> </li> <li class=md-nav__item> <a href=../../dashboards/audit_attribution_analytics/ class=md-nav__link> <span class=md-ellipsis> Attribution Analytics </span> </a> </li> <li class=md-nav__item> <a href=../../dashboards/rba_data_source_overview/ class=md-nav__link> <span class=md-ellipsis> RBA Data Source Review </span> </a> </li> <li class=md-nav__item> <a href=../../dashboards/risk_attributions/ class=md-nav__link> <span class=md-ellipsis> Risk Attributions </span> </a> </li> <li class=md-nav__item> <a href=../../dashboards/risk_investigation/ class=md-nav__link> <span class=md-ellipsis> Risk Investigation </span> </a> </li> <li class=md-nav__item> <a href=../../dashboards/risk_notable_analysis_dashboard/ class=md-nav__link> <span class=md-ellipsis> Risk Notable Analysis </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Contributing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Contributing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing/contributing-guidelines/ class=md-nav__link> <span class=md-ellipsis> Contributing Guidelines </span> </a> </li> <li class=md-nav__item> <a href=../../contributing/contributors/ class=md-nav__link> <span class=md-ellipsis> Contributors </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/splunk/rba/edit/main/docs/searches/deduplicate_notables.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg> </a> <h1 id=deduplicate-notable-events>Deduplicate Notable Events<a class=headerlink href=#deduplicate-notable-events title="Permanent link">&para;</a></h1> <div class="admonition abstract"> <p class=admonition-title>Throttle Alerts Which Have Already Been Reviewed or Fired</p> </div> <p>Because Risk Notables look at a period of time, it is common for a risk_object to keep creating notables as additional (and even duplicate) events roll in, as well as when events fall off as the time period moves forward. Additionally, different Risk Incident Rules could be firing on the same risk_object with the same events but create new Risk Notables. It is difficult to get around this with throttling, so here are some methods to deduplicate notables.</p> <h2 id=navigation>Navigation<a class=headerlink href=#navigation title="Permanent link">&para;</a></h2> <p>Here are two methods for Deduplicating Notable Events:</p> <table> <thead> <tr> <th>-</th> <th>Skill Level</th> <th>Pros</th> <th>Cons</th> </tr> </thead> <tbody> <tr> <td><a href=#method-i>Method I</a></td> <td>Intermediate</td> <td>Deduplicates on front and back end</td> <td>More setup time</td> </tr> <tr> <td><a href=#method-ii>Method II</a></td> <td>Beginner</td> <td>Easy to get started with</td> <td>Only deduplicates on back end</td> </tr> </tbody> </table> <h2 id=method-i>Method I<a class=headerlink href=#method-i title="Permanent link">&para;</a></h2> <p>We'll use a Saved Search to store each Risk Notable's risk events and our analyst's status decision as cross-reference for new notables. Altogether new events will still fire, but repeated events from the same source will not. This also takes care of duplicate notables on the back end as events roll off of our search window.</p> <div class="admonition tip"> <p class=admonition-title>KEEP IN MIND</p> <p>Edits to the <strong>Incident Review - Main</strong> search <strong><em>may</em></strong> be replaced on updates to Enterprise Security; requiring you to make this minor edit again to regain this functionality. Ensure you have a step in your relevant process to check this search after an update.</p> </div> <h3 id=1-create-a-truth-table>1. Create a Truth Table<a class=headerlink href=#1-create-a-truth-table title="Permanent link">&para;</a></h3> <p>This method is described in <a href=https://conf.splunk.com/files/2019/recordings/SEC1908.mp4 target=_blank>Stuart McIntosh's 2019 .conf Talk</a> (about 9m10s in), and we're going to create a similar <a href=https://github.com/splunk/rba/blob/main/lookups/RIR-Truth-Table.csv target=_blank>lookup table</a>. You can either download and import that file yourself, or create something like this in the <a href=https://splunkbase.splunk.com/app/1724 target=_blank>Lookup Editor app</a>:</p> <figure> <p><a class=glightbox href=../../assets/truth_table.png data-type=image data-width=100% data-height=auto data-title="Truth Table" data-desc-position=bottom><img alt="Truth Table" src=../../assets/truth_table.png></a> </p> <figcaption>Truth Table</figcaption> </figure> <h3 id=2-create-a-saved-search>2. Create a Saved Search<a class=headerlink href=#2-create-a-saved-search title="Permanent link">&para;</a></h3> <p>Then we'll create a Saved Search which runs relatively frequently to store notable data and statuses.</p> <ol> <li>Navigate to Settings -&gt; Searches, reports, and alerts.</li> <li>Select "New Report" in the top right.</li> </ol> <div class="admonition quote"> <p>Here is a sample to replicate</p> </div> <figure> <p><a class=glightbox href=../../assets/dedup_search.png data-type=image data-width=100% data-height=auto data-title="Sample Report" data-desc-position=bottom><img alt="Sample Report" src=../../assets/dedup_search.png></a> </p> <figcaption>Sample Report</figcaption> </figure> <div class="language-shell highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>With this SPL</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1> 1</a></span>
<span class=normal><a href=#__codelineno-0-2> 2</a></span>
<span class=normal><a href=#__codelineno-0-3> 3</a></span>
<span class=normal><a href=#__codelineno-0-4> 4</a></span>
<span class=normal><a href=#__codelineno-0-5> 5</a></span>
<span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=nv>index</span><span class=o>=</span>notable<span class=w> </span><span class=nv>eventtype</span><span class=o>=</span>risk_notables
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>indexer_guid</span><span class=o>=</span>replace<span class=o>(</span>_bkt,<span class=s2>&quot;.*~(.+)&quot;</span>,<span class=s2>&quot;\1&quot;</span><span class=o>)</span>,event_hash<span class=o>=</span>md5<span class=o>(</span>_time._raw<span class=o>)</span>,event_id<span class=o>=</span>indexer_guid.<span class=s2>&quot;@@&quot;</span>.index.<span class=s2>&quot;@@&quot;</span>.event_hash
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=p>|</span><span class=w> </span>fields<span class=w> </span>_time<span class=w> </span>event_hash<span class=w> </span>event_id<span class=w> </span>risk_object<span class=w> </span>risk_score<span class=w> </span><span class=nb>source</span><span class=w> </span>orig_source
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>temp_time</span><span class=o>=</span>time<span class=o>()</span>+86400
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=p>|</span><span class=w> </span>lookup<span class=w> </span><span class=nv>update</span><span class=o>=</span><span class=nb>true</span><span class=w> </span><span class=nv>event_time_field</span><span class=o>=</span>temp_time<span class=w> </span>incident_review_lookup<span class=w> </span>rule_id<span class=w> </span>AS<span class=w> </span>event_id<span class=w> </span>OUTPUT<span class=w> </span>status<span class=w> </span>as<span class=w> </span>new_status
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=p>|</span><span class=w> </span>lookup<span class=w> </span><span class=nv>update</span><span class=o>=</span><span class=nb>true</span><span class=w> </span>correlationsearches_lookup<span class=w> </span>_key<span class=w> </span>as<span class=w> </span><span class=nb>source</span><span class=w> </span>OUTPUTNEW<span class=w> </span>default_status
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>status</span><span class=o>=</span><span class=k>case</span><span class=o>(</span>isnotnull<span class=o>(</span>new_status<span class=o>)</span>,new_status,isnotnull<span class=o>(</span>status<span class=o>)</span>,status,1<span class=o>==</span><span class=m>1</span>,default_status<span class=o>)</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=p>|</span><span class=w> </span>fields<span class=w> </span>-<span class=w> </span>temp_time,new_status,default_status
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>temp_status</span><span class=o>=</span><span class=k>if</span><span class=o>(</span>isnull<span class=o>(</span>status<span class=o>)</span>,-1,status<span class=o>)</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=p>|</span><span class=w> </span>lookup<span class=w> </span><span class=nv>update</span><span class=o>=</span><span class=nb>true</span><span class=w> </span>reviewstatuses_lookup<span class=w> </span>_key<span class=w> </span>as<span class=w> </span>temp_status<span class=w> </span>OUTPUT<span class=w> </span>status,label<span class=w> </span>as<span class=w> </span>status_label
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11></a><span class=p>|</span><span class=w> </span>fields<span class=w> </span>-<span class=w> </span>temp_status
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>sources</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=o>(</span>isnull<span class=o>(</span>sources<span class=o>)</span><span class=w> </span>,<span class=w> </span>orig_source<span class=w> </span>,<span class=w> </span>sources<span class=w> </span><span class=o>)</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=p>|</span><span class=w> </span>table<span class=w> </span>_time<span class=w> </span>event_hash<span class=w> </span>risk_object<span class=w> </span><span class=nb>source</span><span class=w> </span>status_label<span class=w> </span>sources<span class=w> </span>risk_score
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=p>|</span><span class=w> </span>reverse
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=p>|</span><span class=w> </span>streamstats<span class=w> </span><span class=nv>current</span><span class=o>=</span>f<span class=w> </span><span class=nv>window</span><span class=o>=</span><span class=m>0</span><span class=w> </span>latest<span class=o>(</span>event_hash<span class=o>)</span><span class=w> </span>as<span class=w> </span>previous_event_hash<span class=w> </span>values<span class=o>(</span>*<span class=o>)</span><span class=w> </span>as<span class=w> </span>previous_*<span class=w> </span>by<span class=w> </span>risk_object
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>previousNotable</span><span class=o>=</span><span class=k>if</span><span class=o>(</span>isnotnull<span class=o>(</span>previous_event_hash<span class=o>)</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;T&quot;</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;F&quot;</span><span class=w> </span><span class=o>)</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=p>|</span><span class=w> </span>fillnull<span class=w> </span><span class=nv>value</span><span class=o>=</span><span class=s2>&quot;unknown&quot;</span><span class=w> </span>previous_event_hash<span class=w> </span>previous_status_label<span class=w> </span>previous_sources<span class=w> </span>previous_risk_score
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>matchScore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=o>(</span><span class=w> </span>risk_score<span class=w> </span>!<span class=o>=</span><span class=w> </span>previous_risk_score<span class=w> </span>,<span class=w> </span><span class=s2>&quot;F&quot;</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;T&quot;</span><span class=w> </span><span class=o>)</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=hll><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><mark class=critic>previousStatus</mark><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>case</span><span class=o>(</span><span class=w> </span>match<span class=o>(</span>previous_status_label,<span class=w> </span><span class=s2>&quot;(Closed)&quot;</span><span class=o>)</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;nonmalicious&quot;</span><span class=w> </span>,<span class=w> </span>match<span class=o>(</span>previous_status_label,<span class=w> </span><span class=s2>&quot;(New|Resolved)&quot;</span><span class=o>)</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;malicious&quot;</span><span class=w> </span>,<span class=w> </span>true<span class=o>()</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;malicious&quot;</span><span class=w> </span><span class=o>)</span>
</span></span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=c1># (1)!</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21></a><span class=p>|</span><span class=w> </span>mvexpand<span class=w> </span>sources
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>matchRR</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=o>(</span>sources<span class=w> </span>!<span class=o>=</span><span class=w> </span>previous_sources<span class=w> </span>,<span class=w> </span><span class=s2>&quot;F&quot;</span>,<span class=w> </span><span class=s2>&quot;T&quot;</span><span class=o>)</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23></a><span class=p>|</span><span class=w> </span>stats<span class=w>  </span>dc<span class=o>(</span>sources<span class=o>)</span><span class=w> </span>as<span class=w> </span>dcSources<span class=w> </span>dc<span class=o>(</span>matchRR<span class=o>)</span><span class=w> </span>as<span class=w> </span>sourceCheckFlag<span class=w> </span>values<span class=o>(</span>*<span class=o>)</span><span class=w> </span>as<span class=w> </span>*<span class=w> </span>by<span class=w> </span>_time<span class=w> </span>risk_object<span class=w> </span>event_hash
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>matchRR</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=o>(</span>sourceCheckFlag<span class=w> </span>&gt;<span class=w> </span><span class=m>1</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;F&quot;</span><span class=w> </span>,<span class=w> </span>matchRR<span class=w> </span><span class=o>)</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25></a><span class=p>|</span><span class=w> </span>lookup<span class=w> </span>RIR-Truth-Table.csv<span class=w> </span>previousNotable<span class=w> </span>previousStatus<span class=w> </span>matchRR<span class=w> </span>matchScore<span class=w> </span>OUTPUT<span class=w> </span>alert
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26></a><span class=p>|</span><span class=w> </span>table<span class=w> </span>_time<span class=w> </span>risk_object<span class=w> </span><span class=nb>source</span><span class=w> </span>risk_score<span class=w> </span>event_hash<span class=w> </span>dcSources<span class=w> </span>alert<span class=w> </span>previousNotable<span class=w> </span>previousStatus<span class=w> </span>matchRR<span class=w> </span>matchScore
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27></a><span class=p>|</span><span class=w> </span>outputlookup<span class=w> </span>RIR-Deduplicate.csv
</span></code></pre></div></td></tr></table></div> <ol> <li><code>previousStatus</code> uses the default ES status label "Closed".</li> </ol> <p>In the <abbr title="Search Processing Language">SPL</abbr> for <code>previousStatus</code> above, I used the default ES status label "Closed" as our only nonmalicious status. You'll have to make sure to use status labels which are relevant for your Incident Review settings. "Malicious" is used as the fallback status just in case, but you may want to differentiate "New" or unmatched statuses as something else for audit purposes; just make sure to create relevant matches in your truth table.</p> <div class="admonition tip"> <p class=admonition-title>I recommend copying the alert column from malicious events</p> </div> <h4 id=schedule-the-saved-search>Schedule the Saved Search<a class=headerlink href=#schedule-the-saved-search title="Permanent link">&para;</a></h4> <div class="language-markdown highlight"><span class=filename>Create schedule</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>    Now find the search in this menu, click <span class=ge>*Edit -&gt; Edit Schedule*</span> and try these settings:
</span></code></pre></div> <div class=result> <p><a class=glightbox href=../../assets/dedup_schedule.png data-type=image data-width=100% data-height=auto data-title="Scheduler settings" data-desc-position=bottom><img align=right alt="Scheduler settings" src=../../assets/dedup_schedule.png width=650></a></p> <ul> <li><strong>Schedule:</strong> Run on Cron Schedule</li> <li><strong>Cron Expression:</strong> <code>*/3 * * * *</code></li> <li><strong>Time Range:</strong> Last 7 days</li> <li><strong>Schedule Priority:</strong> Highest</li> <li><strong>Schedule Window:</strong> No window</li> </ul> </div> <p>I made this search pretty lean, so running it every three minutes should work pretty well; I also decided to only look back seven days as this lookup could balloon in size and cause bundle replication issues. You probably want to stagger your Risk Incident Rule cron schedules by one minute more than this one so they don't fire on the same risk_object with the same risk events.</p> <h3 id=3-deduplicate-notables>3. Deduplicate notables<a class=headerlink href=#3-deduplicate-notables title="Permanent link">&para;</a></h3> <p>Our last step is to ensure that the Incident Review panel doesn't show us notables when we've found a match to our truth table which doesn't make sense to alert on. In the <em>Searches, reports, alerts</em> page, find the search <strong>Incident Review - Main</strong> and click Edit -&gt; Edit Search.</p> <div class="admonition quote"> <p>By default it looks like this:</p> </div> <p><figrue markdown> <a class=glightbox href=../../assets/dedup_ir_old.png data-type=image data-width=100% data-height=auto data-title="Default incident review search" data-desc-position=bottom><img alt="Default incident review search" src=../../assets/dedup_ir_old.png></a> <br> <figcaption>Default incident review search</figcaption></p> </figure> <div class="admonition note"> <p class=admonition-title>And we're just inserting this line after the base search</p> <div class="language-shell highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Append to the base search</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1>1</a></span>
<span class=normal><a href=#__codelineno-2-2>2</a></span>
<span class=normal><a href=#__codelineno-2-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1></a>...
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2></a><span class=p>|</span><span class=w> </span>lookup<span class=w> </span>RIR-Deduplicate.csv<span class=w> </span>_time<span class=w> </span>risk_object<span class=w> </span><span class=nb>source</span><span class=w> </span>OUTPUTNEW<span class=w> </span>alert
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3></a><span class=p>|</span><span class=w> </span>search<span class=w> </span>NOT<span class=w> </span><span class=nv>alert</span><span class=o>=</span><span class=s2>&quot;no&quot;</span>
</span></code></pre></div></td></tr></table></div> </div> <figure> <p><a class=glightbox href=../../assets/dedup_ir_new2.png data-type=image data-width=100% data-height=auto data-title="new incident review search" data-desc-position=bottom><img alt="new incident review search" src=../../assets/dedup_ir_new2.png></a> </p> <figcaption>Updated incident review search</figcaption> </figure> <h3 id=congratulations>Congratulations! <img alt=🥳 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f973.svg title=:partying_face:><a class=headerlink href=#congratulations title="Permanent link">&para;</a></h3> <p>You should now have a significant reduction in duplicate notables</p> <p>If something isn't working, make sure that the Saved Search is correctly outputting a lookup (which should have Global permissions), and ensure if you <code>| inputlookup RIR-Deduplicate.csv</code> you see all of the fields being returned as expected. If Incident Review is not working, something is wrong with the lookup or your edit to that search.</p> <h3 id=extra-credit>Extra Credit<a class=headerlink href=#extra-credit title="Permanent link">&para;</a></h3> <p>If you utilize the <a href=../risk_info_event_detail/ >Risk info field</a> so you have a short and sweet risk_message, you can add another level of granularity to your truth table.</p> <div class="admonition tip"> <p class=admonition-title>if you utilize risk_message for ALL of the event detail, it may be <em>too</em> granular and isn't as helpful for throttling.</p> </div> <p>This is especially useful if you are creating risk events from a data source with its own signatures like EDR, IDS, or DLP. Because the initial truth table only looks at score and correlation rule, if you have one correlation rule importing numerous signatures, you may want to alert when a new signature within that source fires.</p> <h3 id=create-a-calculated-field>Create a calculated field<a class=headerlink href=#create-a-calculated-field title="Permanent link">&para;</a></h3> <p>First, we'll create a new Calculated Field from risk_message in our Risk Datamodel called risk_hash with eval's <code>md5()</code> function, which bypasses the need to deal with special characters or other strangeness that might be in that field. If you haven't done this before - no worries - you just have to go to <em>Settings -&gt; Data Models -&gt; Risk Data Model -&gt; Edit -&gt; Edit Acceleration</em> and turn this off. Afterwards, you can <em>Create New -&gt; Eval Expression</em> like this:</p> <figure> <p><a class=glightbox href=../../assets/calcfield_riskhash.png data-type=image data-width=100% data-height=auto data-title="Creating risk_hash from md5(risk_message) in data model" data-desc-position=bottom><img alt="Creating risk_hash from md5(risk_message) in data model" src=../../assets/calcfield_riskhash.png></a> </p> <figcaption>Creating risk_hash from md5(risk_message) in data model</figcaption> </figure> <details class=danger open=open> <summary>Don't forget to re-enable the acceleration</summary> <p>You may have to rebuild the data model from the <strong>Settings -&gt; Data Model</strong> menu for this field to appear in your events.</p> </details> <h3 id=update-spl>Update <abbr title="Search Processing Language">SPL</abbr><a class=headerlink href=#update-spl title="Permanent link">&para;</a></h3> <p>Then we have to add this field into our Risk Incident Rules by adding this line to their initial <abbr title="Search Processing Language">SPL</abbr> and ensure this field is retained downstream:</p> <div class="language-shell highlight"><span class=filename>Field to add to RiR</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>values<span class=o>(</span>All_Risk.risk_hash<span class=o>)</span><span class=w> </span>as<span class=w> </span>risk_hashes
</span></code></pre></div> <p>Now our Risk Notables will have a multi-value list of <code>risk_message</code> hashes. We must update our truth table to include a field called "matchHashes" - I've created a sample truth table <a href=https://github.com/splunk/rba/blob/main/lookups/RIR-Truth-Table-Hashes.csv target=_blank>here</a>, but you must decide what is the proper risk appetite for your organization.</p> <p>Next we'll edit the Saved Search we created above to include the new fields and logic:</p> <div class="language-shell highlight"><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Updated logic (changes highlighted)</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1> 1</a></span>
<span class=normal><a href=#__codelineno-4-2> 2</a></span>
<span class=normal><a href=#__codelineno-4-3> 3</a></span>
<span class=normal><a href=#__codelineno-4-4> 4</a></span>
<span class=normal><a href=#__codelineno-4-5> 5</a></span>
<span class=normal><a href=#__codelineno-4-6> 6</a></span>
<span class=normal><a href=#__codelineno-4-7> 7</a></span>
<span class=normal><a href=#__codelineno-4-8> 8</a></span>
<span class=normal><a href=#__codelineno-4-9> 9</a></span>
<span class=normal><a href=#__codelineno-4-10>10</a></span>
<span class=normal><a href=#__codelineno-4-11>11</a></span>
<span class=normal><a href=#__codelineno-4-12>12</a></span>
<span class=normal><a href=#__codelineno-4-13>13</a></span>
<span class=normal><a href=#__codelineno-4-14>14</a></span>
<span class=normal><a href=#__codelineno-4-15>15</a></span>
<span class=normal><a href=#__codelineno-4-16>16</a></span>
<span class=normal><a href=#__codelineno-4-17>17</a></span>
<span class=normal><a href=#__codelineno-4-18>18</a></span>
<span class=normal><a href=#__codelineno-4-19>19</a></span>
<span class=normal><a href=#__codelineno-4-20>20</a></span></pre></div></td><td class=code><div><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1></a>...
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>sources</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=o>(</span>isnull<span class=o>(</span>sources<span class=o>)</span><span class=w> </span>,<span class=w> </span>orig_source<span class=w> </span>,<span class=w> </span>sources<span class=w> </span><span class=o>)</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3></a><span class=p>|</span><span class=w> </span>table<span class=w> </span>_time<span class=w> </span>event_hash<span class=w> </span>risk_object<span class=w> </span><span class=nb>source</span><span class=w> </span>status_label<span class=w> </span>sources<span class=w> </span>risk_score<span class=w> </span><mark class=critic>risk_hashes</mark>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4></a><span class=p>|</span><span class=w> </span>reverse
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5></a><span class=p>|</span><span class=w> </span>streamstats<span class=w> </span><span class=nv>current</span><span class=o>=</span>f<span class=w> </span><span class=nv>window</span><span class=o>=</span><span class=m>0</span><span class=w> </span>latest<span class=o>(</span>event_hash<span class=o>)</span><span class=w> </span>as<span class=w> </span>previous_event_hash<span class=w> </span>values<span class=o>(</span>*<span class=o>)</span><span class=w> </span>as<span class=w> </span>previous_*<span class=w> </span>by<span class=w> </span>risk_object
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>previousNotable</span><span class=o>=</span><span class=k>if</span><span class=o>(</span>isnotnull<span class=o>(</span>previous_event_hash<span class=o>)</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;T&quot;</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;F&quot;</span><span class=w> </span><span class=o>)</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7></a><span class=p>|</span><span class=w> </span>fillnull<span class=w> </span><span class=nv>value</span><span class=o>=</span><span class=s2>&quot;unknown&quot;</span><span class=w> </span>previous_event_hash<span class=w> </span>previous_status_label<span class=w> </span>previous_sources<span class=w> </span>previous_risk_score<span class=w> </span><mark class=critic>previous_risk_hashes</mark>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>matchScore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=o>(</span><span class=w> </span>risk_score<span class=w> </span>!<span class=o>=</span><span class=w> </span>previous_risk_score<span class=w> </span>,<span class=w> </span><span class=s2>&quot;F&quot;</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;T&quot;</span><span class=w> </span><span class=o>)</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>previousStatus</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>case</span><span class=o>(</span><span class=w> </span>match<span class=o>(</span>previous_status_label,<span class=w> </span><span class=s2>&quot;(Closed)&quot;</span><span class=o>)</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;nonmalicious&quot;</span><span class=w> </span>,<span class=w> </span>match<span class=o>(</span>previous_status_label,<span class=w> </span><span class=s2>&quot;(New|Resolved)&quot;</span><span class=o>)</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;malicious&quot;</span><span class=w> </span>,<span class=w> </span>true<span class=o>()</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;malicious&quot;</span><span class=w> </span><span class=o>)</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10></a><span class=hll><span class=p>|</span><span class=w> </span>mvexpand<span class=w> </span>risk_hashes
</span></span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11></a><span class=hll><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>matchHashes</span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=o>(</span>risk_hashes<span class=w> </span>!<span class=o>=</span><span class=w> </span>previous_risk_hashes<span class=w> </span>,<span class=w> </span><span class=s2>&quot;F&quot;</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;T&quot;</span><span class=w> </span><span class=o>)</span>
</span></span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12></a><span class=hll><span class=p>|</span><span class=w> </span>stats<span class=w> </span>dc<span class=o>(</span>matchHashes<span class=o>)</span><span class=w> </span>as<span class=w> </span>hashCheckFlag<span class=w> </span>values<span class=o>(</span>*<span class=o>)</span><span class=w> </span>as<span class=w> </span>*<span class=w> </span>by<span class=w> </span>_time<span class=w> </span>risk_object<span class=w> </span>event_hash
</span></span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13></a><span class=hll><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>matchHashes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=o>(</span>hashCheckFlag<span class=w> </span>&gt;<span class=w> </span><span class=m>1</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;F&quot;</span><span class=w> </span>,<span class=w> </span>matchHashes<span class=w> </span><span class=o>)</span>
</span></span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14></a><span class=p>|</span><span class=w> </span>mvexpand<span class=w> </span>sources
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>matchRR</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=o>(</span>sources<span class=w> </span>!<span class=o>=</span><span class=w> </span>previous_sources<span class=w> </span>,<span class=w> </span><span class=s2>&quot;F&quot;</span>,<span class=w> </span><span class=s2>&quot;T&quot;</span><span class=o>)</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16></a><span class=p>|</span><span class=w> </span>stats<span class=w>  </span>dc<span class=o>(</span>sources<span class=o>)</span><span class=w> </span>as<span class=w> </span>dcSources<span class=w> </span>dc<span class=o>(</span>matchRR<span class=o>)</span><span class=w> </span>as<span class=w> </span>sourceCheckFlag<span class=w> </span>values<span class=o>(</span>*<span class=o>)</span><span class=w> </span>as<span class=w> </span>*<span class=w> </span>by<span class=w> </span>_time<span class=w> </span>risk_object<span class=w> </span>event_hash
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17></a><span class=p>|</span><span class=w> </span><span class=nb>eval</span><span class=w> </span><span class=nv>matchRR</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>if</span><span class=o>(</span>sourceCheckFlag<span class=w> </span>&gt;<span class=w> </span><span class=m>1</span><span class=w> </span>,<span class=w> </span><span class=s2>&quot;F&quot;</span><span class=w> </span>,<span class=w> </span>matchRR<span class=w> </span><span class=o>)</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18></a><span class=p>|</span><span class=w> </span>lookup<span class=w> </span>RIR-Truth-Table.csv<span class=w> </span>previousNotable<span class=w> </span>previousStatus<span class=w> </span>matchRR<span class=w> </span>matchScore<span class=w> </span><mark class=critic>matchHashes</mark><span class=w> </span>OUTPUT<span class=w> </span>alert
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19></a><span class=p>|</span><span class=w> </span>table<span class=w> </span>_time<span class=w> </span>risk_object<span class=w> </span><span class=nb>source</span><span class=w> </span>risk_score<span class=w> </span>event_hash<span class=w> </span>dcSources<span class=w> </span>alert<span class=w> </span>previousNotable<span class=w> </span>previousStatus<span class=w> </span>matchRR<span class=w> </span>matchScore<span class=w> </span><mark class=critic>matchHashes</mark>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20></a><span class=p>|</span><span class=w> </span>outputlookup<span class=w> </span>RIR-Deduplicate.csv
</span></code></pre></div></td></tr></table></div> <p>Voila! We now ensure that our signature-based risk rule data sources will properly alert if there are interesting new events for that risk object.</p> <hr> <h2 id=method-ii>Method II<a class=headerlink href=#method-ii title="Permanent link">&para;</a></h2> <p>This method is elegantly simple to ensure notables don't re-fire as earlier events drop off the rolling search window of your Risk Incident Rules. It does this by only firing if the latest risk event is from the past 70 minutes.</p> <div class="language-text highlight"><span class=filename>Append to existing RIR</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>...
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>| stats latest(_indextime) AS latest_risk
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>| where latest_risk &gt;= relative_time(now(),&quot;-70m@m&quot;)
</span></code></pre></div> <p>Credit to Josh Hrabar and James Campbell, this is brilliant. Thanks y'all!</p> <hr> <p><small>Authors</small></p> <div class=zts-tooltip> <a class=zts-author href=../../contributing/contributors target=_blank alt="7thdrxn - Haylee Mills"> <img class=github-avatar src="https://avatars.githubusercontent.com/u/12771156?v=4"> </a> <span class=zts-tooltip-text>@7thdrxn - Haylee Mills</span> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">June 14, 2024</span> <br> Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 22, 2022</span> </small> </div> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/splunk/rba target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.action.edit", "navigation.indexes", "navigation.instant", "navigation.tabs", "navigation.sections", "navigation.top", "toc.integrate", "toc.follow", "navigation.tracking", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.cd18aaf1.min.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body> </html>